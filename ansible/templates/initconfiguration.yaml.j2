apiVersion: kubeadm.k8s.io/v1beta2
kind: InitConfiguration
bootstrapTokens:
  - description: generated by ansible-playbook
    ttl: 10m
    token: 9a08jv.c0izixklcxtmnze7
nodeRegistration:
  kubeletExtraArgs:
    cgroup-driver: systemd
    cluster-dns: 10.96.0.10
localAPIEndpoint:
  bindPort: 6443
# Doesn't work in v1beta2 (only v1beta3)
skipPhases:
  - addon/coredns
  - addon/kube-proxy
---
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v{{ kube_version }}
clusterName: mykubelocal
imageRepository: "registry.k8s.io"
controlPlaneEndpoint: "localkube:443"
apiServer:
  extraArgs:
    authorization-mode: "Node,RBAC"
  timeoutForControlPlane: 4m0s
dns:
  imageRepository: registry.k8s.io/coredns
  type: CoreDNS
etcd:
  local:
    dataDir: "/var/lib/etcd"
networking:
  dnsDomain: "mykube.local"
  serviceSubnet: "10.96.0.0/16"
  podSubnet: "10.244.0.0/16"
controllerManager:
  extraArgs:
    bind-address: "0.0.0.0"
---
apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
mode: ipvs
ipvs:
  scheduler: rr
